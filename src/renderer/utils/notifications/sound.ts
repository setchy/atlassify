import type { Percentage } from '../../types';

const MINIMUM_VOLUME_PERCENTAGE = 0 as Percentage;
const MAXIMUM_VOLUME_PERCENTAGE = 100 as Percentage;
const VOLUME_STEP = 10 as Percentage;

// Cache audio instance to avoid re-creating elements on every notification.
let cachedAudio: HTMLAudioElement | null = null;

export async function raiseSoundNotification(volume: Percentage) {
  if (!cachedAudio) {
    const path = await window.atlassify.notificationSoundPath();

    cachedAudio = new Audio(path);
  }

  const audio = cachedAudio;

  audio.volume = volumePercentageToLevel(volume);
  audio.play();
}

/**
 * Convert volume percentage (0-100) to level (0.0-1.0)
 */
export function volumePercentageToLevel(percentage: Percentage): number {
  return percentage / 100;
}

/**
 * Returns true if can decrease volume percentage further
 */
export function canDecreaseVolume(volumePercentage: Percentage) {
  return volumePercentage - VOLUME_STEP >= MINIMUM_VOLUME_PERCENTAGE;
}

/**
 * Returns true if can increase volume percentage further
 */
export function canIncreaseVolume(volumePercentage: Percentage) {
  return volumePercentage + VOLUME_STEP <= MAXIMUM_VOLUME_PERCENTAGE;
}

/**
 * Decrease volume by step amount
 */
export function decreaseVolume(volume: Percentage): Percentage {
  if (canDecreaseVolume(volume)) {
    return (volume - VOLUME_STEP) as Percentage;
  }

  return MINIMUM_VOLUME_PERCENTAGE;
}

/**
 * Increase volume by step amount
 */
export function increaseVolume(volume: Percentage): Percentage {
  if (canIncreaseVolume(volume)) {
    return (volume + VOLUME_STEP) as Percentage;
  }

  return MAXIMUM_VOLUME_PERCENTAGE;
}
